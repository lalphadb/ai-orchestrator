# AI Orchestrator Backend v7.0 - Configuration Template
# SECURITY: Never commit .env file with real secrets!

APP_VERSION=7.0
APP_NAME=AI Orchestrator

# Logging (v7.1)
# LOG_LEVEL: DEBUG, INFO, WARNING, ERROR, CRITICAL
# LOG_FORMAT: text (human-readable) ou json (parsable, production)
LOG_LEVEL=INFO
LOG_FORMAT=text

# Ollama (local LLM server)
OLLAMA_URL=http://localhost:11434
OLLAMA_BASE_URL=http://localhost:11434

# Modèles - Options: groq/llama-3.3-70b-versatile, ollama/kimi-k2:1t-cloud, etc.
DEFAULT_MODEL=groq/llama-3.3-70b-versatile
EXECUTOR_MODEL=groq/llama-3.3-70b-versatile

# API Keys (REQUIRED if using Groq)
# Get your key from: https://console.groq.com/keys
# GROQ_API_KEY=your_actual_groq_api_key_here

# Sécurité (REQUIRED in production - CRQ-P0-6)
# CRITICAL: SECRET_KEY is MANDATORY in production to prevent user disconnections on restart
# Generate with: python3 -c "import secrets; print(secrets.token_urlsafe(64))"
# Use either JWT_SECRET_KEY or SECRET_KEY (both are equivalent)
# NEVER use default values or commit secrets to git!
# JWT_SECRET_KEY=<REQUIRED - Generate random 64+ char string>
# SECRET_KEY=<REQUIRED - Alternative name for JWT_SECRET_KEY>
# ADMIN_PASSWORD=<REQUIRED - Use a strong password with 16+ chars>

# Base de données
DATABASE_URL=sqlite:///./ai_orchestrator.db

# Workflow
VERIFY_REQUIRED=false
MAX_REPAIR_CYCLES=2
MAX_ITERATIONS=10

# EXECUTION MODE
# Options: direct (host execution), sandbox (Docker isolation)
EXECUTE_MODE=sandbox

# ChromaDB (vector database for learning)
CHROMA_HOST=localhost
CHROMA_PORT=8000

# Rate Limiting
RATE_LIMIT_PER_MINUTE=30
RATE_LIMIT_BURST=10

# Timeouts (secondes) - v7.1
# HTTP Timeouts
TIMEOUT_HTTP_REQUEST=30           # Requêtes HTTP externes
TIMEOUT_OLLAMA_CHAT=120           # Génération LLM (peut être longue)
TIMEOUT_OLLAMA_CONNECT=10         # Connexion Ollama
TIMEOUT_OLLAMA_LIST=10            # Liste modèles
TIMEOUT_HEALTH_CHECK=5            # Health checks

# Command Execution Timeouts
TIMEOUT_COMMAND_DEFAULT=30        # Commandes shell simples
TIMEOUT_GIT=10                    # Git status
TIMEOUT_GIT_DIFF=30               # Git diff
TIMEOUT_TESTS=300                 # Tests (5 min)
TIMEOUT_LINT=60                   # Linting
TIMEOUT_TYPECHECK=60              # Type checking
TIMEOUT_BUILD=180                 # Builds (3 min)
TIMEOUT_DOCKER=300                # Docker compose (5 min)

# Database Timeouts
TIMEOUT_DB_CONNECT=10             # Connexion SQLite
TIMEOUT_DB_QUERY=10               # Requêtes DB

# CORS Origins (comma-separated)
# Production: ONLY use your actual domain(s)
# Example: CORS_ORIGINS=https://ai.4lb.ca,https://llm.4lb.ca
# Development: CORS_ORIGINS=http://localhost:3000
CORS_ORIGINS=http://localhost:3000

# Agent Isolation (CRQ-P0-1 - v8.0.3)
# Enforce agent tool restrictions at execution level
# When enabled, agents can ONLY use tools in their allowed_tools set
# Default: false (backward compatibility)
# Production: Recommended to enable (true)
ENFORCE_AGENT_ISOLATION=false

# Governance Blocking (CRQ-P0-2 - v8.0.3)
# Make governance checks fail-closed instead of permissive
# When enabled, governance errors BLOCK tool execution instead of just logging warnings
# CRITICAL actions will fail the run if governance denies them
# Emits 'governance_denied' WebSocket events when actions are blocked
# Default: false (backward compatibility - legacy permissive mode)
# Production: Recommended to enable (true)
ENFORCE_GOVERNANCE_BLOCKING=false

# Prompt Injection Detection (CRQ-P0-3 - v8.0.3)
# Detect and block prompt injection attempts in tool parameters
# Scans all string parameters for suspicious patterns (role manipulation, instruction extraction, etc.)
# When enabled, CRITICAL/HIGH severity injections are blocked before tool execution
# Emits 'prompt_injection_blocked' WebSocket events when blocked
# Default: false (backward compatibility)
# Production: Recommended to enable (true) after testing for false positives
ENFORCE_PROMPT_INJECTION_DETECTION=false

# Prompt Injection Strict Mode (CRQ-P0-3 - v8.0.3)
# When true, also blocks MEDIUM severity injections (more aggressive)
# Only active if ENFORCE_PROMPT_INJECTION_DETECTION=true
# Default: false (block only CRITICAL/HIGH)
# Production: Enable only if needed (may cause false positives)
PROMPT_INJECTION_STRICT_MODE=false

# HttpOnly Cookies (CRQ-P0-4 - v8.0.3)
# Store JWT tokens in HttpOnly cookies instead of response body
# Protects against XSS attacks (JavaScript cannot access HttpOnly cookies)
# When disabled, tokens are returned in response body (legacy behavior)
# Default: false (backward compatibility)
# Production: Recommended to enable (true)
USE_HTTPONLY_COOKIES=false

# Cookie Security Settings (CRQ-P0-4)
# COOKIE_SECURE: Require HTTPS for cookies (true in production, false in dev)
# COOKIE_SAMESITE: lax, strict, or none (lax recommended)
# COOKIE_DOMAIN: Specific domain or null for current domain only
COOKIE_SECURE=true
COOKIE_SAMESITE=lax
# COOKIE_DOMAIN=

# Memory Cleanup (CRQ-P0-5 - v8.0.3)
# Automatic cleanup of expired memories and quota enforcement
# Prevents memory leaks from unbounded memory growth
# ENABLE_MEMORY_CLEANUP: Enable/disable cleanup (false = legacy behavior)
# MEMORY_TTL_DAYS: Time-to-live for memories (default: 7 days)
# MEMORY_MAX_DOCUMENTS: Max entries before purging oldest 10% (default: 10,000)
# MEMORY_CLEANUP_INTERVAL_HOURS: Cleanup frequency (default: 1 hour)
# Default: false (backward compatibility)
# Production: Recommended to enable (true)
ENABLE_MEMORY_CLEANUP=false
MEMORY_TTL_DAYS=7
MEMORY_MAX_DOCUMENTS=10000
MEMORY_CLEANUP_INTERVAL_HOURS=1
