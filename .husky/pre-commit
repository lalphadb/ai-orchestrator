#!/bin/sh

echo "üîç Pre-commit checks..."

# Run backend tests (quick subset)
echo "üß™ Running backend tests..."
cd "$(git rev-parse --show-toplevel)/backend" && ../.venv/bin/python -m pytest tests/ -x -q --ignore=tests/test_correlation_id.py --ignore=tests/test_strict_csp.py 2>/dev/null
BACKEND_STATUS=$?
cd "$(git rev-parse --show-toplevel)"

if [ $BACKEND_STATUS -ne 0 ]; then
  echo "‚ùå Backend tests failed"
  exit 1
fi

# Run frontend linting
echo "üé® Checking frontend linting..."
cd "$(git rev-parse --show-toplevel)/frontend" && npx eslint src/ --quiet 2>/dev/null
LINT_STATUS=$?
cd "$(git rev-parse --show-toplevel)"

if [ $LINT_STATUS -ne 0 ]; then
  echo "‚ö†Ô∏è  ESLint errors found (not blocking)"
fi

echo "‚úÖ Pre-commit checks complete!"
